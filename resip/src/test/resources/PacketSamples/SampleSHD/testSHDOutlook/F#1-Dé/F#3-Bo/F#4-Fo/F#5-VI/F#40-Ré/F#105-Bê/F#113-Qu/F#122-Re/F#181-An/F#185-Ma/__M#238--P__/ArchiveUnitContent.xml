<Content>
    <DescriptionLevel>Item</DescriptionLevel>
    <Title>[Projet VITAM 0000019]: [API-accession-register-detail-POST] : Rechercher via API d&apos;un service producteur inexistant - HTTP 500 au lieu de 404</Title>
    <OriginatingSystemId>&lt;9e8dfb092c48a2855158333642259dfb@213.32.79.242&gt;</OriginatingSystemId>
    <Writer>
        <FirstName>Mantis Bug Tracker</FirstName>
        <BirthName>Mantis Bug Tracker</BirthName>
        <Identifier>admtlvitam@gmail.com</Identifier>
    </Writer>
    <Addressee>
        <FirstName>thierry.casimirius</FirstName>
        <BirthName>thierry.casimirius</BirthName>
        <Identifier>thierry.casimirius@intradef.gouv.fr</Identifier>
    </Addressee>
    <SentDate>2016-12-15T16:05:49Z</SentDate>
    <ReceivedDate>2016-12-15T16:05:58Z</ReceivedDate>
    <TextContent>Le bogue suivant a été soumis. 
====================================================================== 
http://213.32.79.242/mantisbt/view.php?id=19 
====================================================================== 
Rapporteur:                 Omar
Responsable:                Omar
====================================================================== 
Projet:                     Projet VITAM
Bogue ID:                   19
Catégorie:                  VITAM
Reproductibilité:           toujours
Impact:                     mineur
Priorité:                   normale
Statut:                     affecté
Comportement attendu:        
US concernée:                
====================================================================== 
Date de soumission:         2016-12-15 17:05 CET
Dernière modification:      2016-12-15 17:05 CET
====================================================================== 
Résumé:                     [API-accession-register-detail-POST] : Rechercher
via API d&apos;un service producteur inexistant - HTTP 500 au lieu de 404
Description: 
En interrogeant pour un  service producteur existant cela fonctionne
correctement.
Par contre une erreur 500 non fonctionnel apparait lorsque on interroge avec un
service producteur inexistant (on indique bien dans l’url un service
producteur qui est le même que dans le JSON envoyé) cf pj
En s’attend par exemple à avoir une réponse indiquant que « service
producteur » est inexistant ou un total 0 ou au pire une HTTP 404 qui est
indiqué dans la documentation
/doc/raml/externe/access.html#accession_register__idu__accession_register_detail_post


Étapes pour le reproduire: 
Envoyer une des requêtes HTTP suivantes:


POST
https://213.32.79.242:8444/access-external/v1/accession-register/AurelienH/accession-register-detail?g_originatingagency=AurelienH
HTTP/1.1
Accept-Encoding: gzip,deflate
X-Http-Method-Override: GET
Accept: application/json
Content-Type: application/json
Content-Length: 85
Host: 213.32.79.242:8444
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

{&quot;$query&quot;:{&quot;$and&quot;:[{&quot;$eq&quot;:{&quot;OriginatingAgency&quot;:&quot;x&quot;}}]},&quot;$filter&quot;:{},&quot;$projection&quot;:{}}

OU


POST
https://213.32.79.242:8444/access-external/v1/accession-register/x/accession-register-detail?g_originatingagency=AurelienH
HTTP/1.1
Accept-Encoding: gzip,deflate
X-Http-Method-Override: GET
Accept: application/json
Content-Type: application/json
Content-Length: 85
Host: 213.32.79.242:8444
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

{&quot;$query&quot;:{&quot;$and&quot;:[{&quot;$eq&quot;:{&quot;OriginatingAgency&quot;:&quot;x&quot;}}]},&quot;$filter&quot;:{},&quot;$projection&quot;:{}}


OU


POST
https://213.32.79.242:8444/access-external/v1/accession-register/AurelienH/accession-register-detail?g_originatingagency=AurelienH
HTTP/1.1
Accept-Encoding: gzip,deflate
X-Http-Method-Override: GET
Accept: application/json
Content-Type: application/json
Content-Length: 85
Host: 213.32.79.242:8444
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

{&quot;$query&quot;:{&quot;$and&quot;:[{&quot;$eq&quot;:{&quot;OriginatingAgency&quot;:&quot;AurelienH&quot;}}]},&quot;$filter&quot;:{},&quot;$projection&quot;:{}}

A noter que AurelienH existe

Informations complémentaires: 
Une réponse type est

HTTP/1.1 500 Internal Server Error
Date: Thu, 15 Dec 2016 16:00:29 GMT
Set-Cookie: rememberMe=deleteMe; Path=/; Max-Age=0; Expires=Wed, 14-Dec-2016
16:00:29 GMT
Content-Type: application/json
X-REQUEST-ID: aeeaaaaaacaam7mxabpfmakzam3khayaaaaq
Content-Length: 180
Server: Jetty(9.3.13.v20161014)

{&quot;httpCode&quot;:500,&quot;code&quot;:&quot;INTERNAL_SERVER_ERROR&quot;,&quot;context&quot;:&quot;ACCESS_EXTERNAL&quot;,&quot;state&quot;:&quot;code_vitam&quot;,&quot;message&quot;:&quot;Internal
Server Error&quot;,&quot;description&quot;:&quot;Internal Server Error&quot;,&quot;errors&quot;:[]}
====================================================================== 

Historique du bogue 
Date de modificationNom d’utilisateurChamp                    Changement      
    
====================================================================== 
2016-12-15 17:05 Omar           Nouveau bogue                                
2016-12-15 17:05 Omar           Statut                   nouveau =&gt; affecté  
2016-12-15 17:05 Omar           Assigné à                 =&gt; Omar            
======================================================================</TextContent>
</Content>