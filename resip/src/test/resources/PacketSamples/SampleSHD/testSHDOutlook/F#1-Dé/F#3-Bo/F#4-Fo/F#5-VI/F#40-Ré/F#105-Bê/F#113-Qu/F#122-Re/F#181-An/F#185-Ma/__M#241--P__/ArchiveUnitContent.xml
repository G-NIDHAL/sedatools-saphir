<Content>
    <DescriptionLevel>Item</DescriptionLevel>
    <Title>[Projet VITAM 0000017]: Impossibilité d&apos;utiliser l&apos;opérateur $and dans la collection Rules</Title>
    <OriginatingSystemId>&lt;5b8a58562116ab66da359e2a7315c16c@213.32.79.242&gt;</OriginatingSystemId>
    <Writer>
        <FirstName>Mantis Bug Tracker</FirstName>
        <BirthName>Mantis Bug Tracker</BirthName>
        <Identifier>admtlvitam@gmail.com</Identifier>
    </Writer>
    <Addressee>
        <FirstName>thierry.casimirius</FirstName>
        <BirthName>thierry.casimirius</BirthName>
        <Identifier>thierry.casimirius@intradef.gouv.fr</Identifier>
    </Addressee>
    <SentDate>2016-12-15T12:40:58Z</SentDate>
    <ReceivedDate>2016-12-15T12:41:05Z</ReceivedDate>
    <TextContent>Le bogue suivant a été soumis. 
====================================================================== 
http://213.32.79.242/mantisbt/view.php?id=17 
====================================================================== 
Rapporteur:                 Jonathan
Responsable:                Jonathan
====================================================================== 
Projet:                     Projet VITAM
Bogue ID:                   17
Catégorie:                  BugFromTestlink
Reproductibilité:           toujours
Impact:                     majeur
Priorité:                   normale
Statut:                     affecté
Comportement attendu:        
US concernée:                
====================================================================== 
Date de soumission:         2016-12-15 13:40 CET
Dernière modification:      2016-12-15 13:40 CET
====================================================================== 
Résumé:                     Impossibilité d&apos;utiliser l&apos;opérateur $and dans
la collection Rules
Description: 
Nous cherchons a obtenir la liste des règles de type AccessRule et qui ont une
valeur 75 dans le champs RuleDuration via cette requête  : 
{
  &quot;$query&quot;:
    {
      &quot;$and&quot;: [
        {
          &quot;$eq&quot;: {
            &quot;RuleType&quot;: &quot;AccessRule&quot;
          }
        },
        {
          &quot;$eq&quot;: {
            &quot;RuleDuration&quot;: &quot;75&quot;
          }
        }
      ]
    }
,
  &quot;$filter&quot;: {},
  &quot;$projection&quot;: {}
}

Nous obtenons a chaque tentative une erreur 500
Nous avons essayé la même requête mais avec un &quot;$or&quot; à la place du &quot;$and&quot; et
nous obtenons bien comme résultat toutes les AccessRule et toutes les règles
avec une Duration de 75

Dans d&apos;autre collection nous avons tester la balise &quot;$and&quot; avec succès :
{
  &quot;$roots&quot;: [],
  &quot;$query&quot;: [
    {
      &quot;$and&quot;: [
        {
          &quot;$match&quot;: {
            &quot;Title&quot;: &quot;api&quot;
          }
        },
        {
          &quot;$match&quot;: {
            &quot;Description&quot;: &quot;Vitam&quot;
          }
        }
      ],
      &quot;$depth&quot;: 20
    }
  ],
  &quot;$filter&quot;: {
    &quot;$orderby&quot;: {
      &quot;TransactedDate&quot;: 1
    }
  },
  &quot;$projection&quot;: {}
}

Informations complémentaires: 
PVI-470
====================================================================== 

Historique du bogue 
Date de modificationNom d’utilisateurChamp                    Changement      
    
====================================================================== 
2016-12-15 13:40 Jonathan       Nouveau bogue                                
2016-12-15 13:40 Jonathan       Statut                   nouveau =&gt; affecté  
2016-12-15 13:40 Jonathan       Assigné à                 =&gt; Jonathan        
2016-12-15 13:40 Jonathan       Fichier ajouté:
PVI-470_15-12-2016-01-40_OUT.json                    
======================================================================</TextContent>
</Content>