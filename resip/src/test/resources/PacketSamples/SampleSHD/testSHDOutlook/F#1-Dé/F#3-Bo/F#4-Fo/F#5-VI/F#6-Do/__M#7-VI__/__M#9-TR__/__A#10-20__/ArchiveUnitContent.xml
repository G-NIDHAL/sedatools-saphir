<Content>
    <DescriptionLevel>Item</DescriptionLevel>
    <Title>20170619 - Vitam_Sizing_v0.6-CustoArchipel.ods</Title>
    <Description>Document &quot;20170619 - Vitam_Sizing_v0.6-CustoArchipel.ods&quot; joint au message &lt;0CEBDBC4E24A8C46BD4E1D2201D7574120D8CCD4@DRSCZ-MMVLWM05P.DR-RES.INTRADEF.GOUV.FR&gt;</Description>
    <CreatedDate>2017-06-18T23:02:31Z</CreatedDate>
    <TextContent>???
Page 
??? (???)
00/00/0000, 00:00:00
Page  / 
	Légende
	
		Hypothèse métier / technique du projet d&apos;implémentation

		Hypothèse / mesure VITAM

		Résultat final de calcul

	
	Onglets
	
	hypothèses
	Hypothèses métier et techniques dimensionnantes ; résultats associés

	components
	Détail des composants vitam, de leur topologie de déploiement et des besoins en resources associées

	pivot_components
	Synthèse des besoins ; /!\ ATTENTION /!\ : ce tableau ne prend pas encore le nombre d&apos;instance dans les calculs

	ref
	Tables de références (ne pas modifier)

	
	

	Données brutes : archives
		
	Hypothèses métier
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Nombre total d&apos;Archive Unit parentes
	20 000
	n/a
	20000
	Il s&apos;agit des archives unit de tous niveaux

	Nombre total d&apos;Archive Unit feuilles
	2 000 000
	n/a
	2000000
	I.e. directement rattachées à un Object Group

	Nombre total de Binary Data Object par Object Group
	1
	n/a
	1
	
	Taille moyenne d&apos;un Binary Data Object
	5
	Mo
	5242880
	Estimation : taille d&apos;image RAW

	Taille maximale d&apos;un Binary Data Object
	10
	Mo
	10485760
	
	Taille moyenne des métadonnées d&apos;une Archive Unit parente
	2
	Ko
	2048
	Métadonnées métier

	Taille moyenne des métadonnées d&apos;une Archive Unit feuille
	4
	Ko
		Métadonnées métier

	Taille moyenne des métadonnées d&apos;un Object Group (sans le contenu des BDO)
	50
	octets
	50
	Sans le contenu des BDO

	Taille moyenne des métadonnées associées à un objet binaire
	4
	Ko
	4096
	Dans VITAM, les MD des BDO sont stockées au final dans l&apos;OG ; au final, taille MD OG total = taille MD OG + (Nbre BDO par OG) x (taille MD BDO) ; 4Ko =&gt; métadonnéesEXIF

	Nombre d&apos;opérations d&apos;ingest
	5000
	n/a
	5000
	
	Nombre d&apos;opérations d&apos;update
	5000
	n/a
	5000
	
	Hypothèses VITAM
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Taille moyenne du journal de cycle de vie d&apos;une AU
	10
	Ko
	10240
	
	Taille d&apos;une entrée « ingest » dans le journal des opérations
	50
	Ko
	51200
	
	Taille d&apos;une entrée « update » dans le journal des opérations
	5
	Ko
	5120
	On néglige je JOP lié aux référentiels

	Nombre d&apos;Object Group stockés
	2 000 000
	n/a
	2000000
	Hypothèse simple : lien 1::1 entre AU feuilles et OG

	Taille totale des référentiels
	52
	Go
	55834574848
	Contient tous les référentiels (y compris le registre des fonds)

	Ratio de sécurisation des journaux
	20
	%
	0,2
	
	Calcul
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Volumétrie brute totale des fichiers binaires par offre de stockage (storage-offer)
	10
	To
	10485760000000
	Impact : storage-offer (FS local ou swift)

	Volumétrie brute totale des métadonnées
	8
	Go
	8332960000
	Impact : metadata (MongoDB &amp; ES) + storage-offer (FS local ou swift)

	Volumétrie brute des journaux
	20
	Go
	20 966 400 000
	Impact : logbook (MongoDB &amp; ES) ; on néglige la taille du journal des actes d&apos;administration

	Volumétrie brute des référentiels
	52
	Go
	55 834 574 848
	Impact : masterdata (MongoDB &amp; ES)

	Volumétrie brute des journaux sécurisés
	4
	Go
	4 193 280 000
	Impact : storage-offer (FS local ou swift)

	Volumétrie totale du stockage
	10
	To
	10 498 286 240 000
	Impact : storage-offer (FS local ou swift)

	
	Données brutes : fonctionnement (ingest)
		
	Hypothèses métier
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Taille maximale d&apos;un versement (taille du fichier SIP)
	10
	Go
	10737418240
	Pour nous : 10 Go à 100 Go

	Taux de compression d&apos;un SIP entrant
	90
	%
	0,9
	I.e. pour 60 %, un SIP de 60 Ko contient 100 Ko de données

	Nombre de versements possibles en parallèle
	5
	n/a
	5
	
	Hypothèses VITAM
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Taille d&apos;une entrée du journal des écritures
	500
	octets
	500
	
	Degré de parallélisme interne aux workers
	8
	n/a
	8
	Hypothèse simple : lien 1::1 entre AU feuilles et OG

	Nombre maximum de SIP dans le sas externe (en simultané)
	4
	n/a
	4
	
	Calcul
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Volumétrie de l&apos;espace de travail
	11
	Go
	11930464711,1111
	Impact : workspace (FS local)

	Volumétrie du journal des écritures pour l&apos;ingest
	5
	Go
	5025000000
	Impact : storage (FS local) ; x2 pour les GOT &amp; AU (JCV) ; à compléter pour la sécurisation des journaux

	Volumétrie temporaire des workers
	80
	Mo
	83886080
	Impact : workers (FS local)

	Volumétrie du sas externe
	40
	Go
	42949672960
	Impact : ingest-external (FS local)

	
	Données brutes : fonctionnement (logs)
		
	Hypothèses VITAM
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Taille d&apos;un log par Archive Unit présente dans le système
	21,2992
	Ko
	21810,3808
	Sur les environnements de test, 520 Mo de datafiles elasticsearch-log sur 1 nœud pour 25000 Archive Unit (si on ne supprime aucun log technique)

	Calcul
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Volumétrie brute des logs techniques
	41
	Go
	44056969216
	
			
	Données réelles : bases de données
		
	Hypothèses techniques
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Facteur de réplication MongoDB (replica)
	3
	n/a
	3
	Soit 1 donnée et 2 copies

	Facteur réplication elasticsearch-data
	3
	n/a
	3
	Soit 1 donnée et 2 copies

	Facteur réplication elasticsearch-log
	2
	n/a
	2
	Soit 1 donnée et 1 copie

	Hypothèses VITAM
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	elasticsearch-data : net / brut (i.e. taille des datafiles / tailles des données)
	2
	n/a
	2
	Elasticsearch stocke les données sources avec les données d&apos;index, et indexe tous les champs

	elasticsearch-log : net / brut (i.e. taille des datafiles / tailles des données)
	2
	n/a
	2
	Idem ; note : en elastic 2.4, obligation de garder la source

	Mongo : net / brut (i.e. taille des datafiles / tailles des données) : logbook
	2
	n/a
	1,52
	Correspond à data + indexes (ratio présent sur les environnements de test)

	Mongo : net / brut (i.e. taille des datafiles / tailles des données) : metadata
	2
	n/a
	1,52
	
	Mongo : net / brut (i.e. taille des datafiles / tailles des données) : référentiels
	1
	n/a
	1,2
	
	Calcul
	Valeur
	Unité
	Valeur norm.
	Commentaire / Explication

	Taille totale des datafiles MongoDB (tous serveurs mongod confondus)
	312
	Go
	334 609 551 053
	
	Taille totale des datafiles elasticsearch-data (tous nœuds confondus)
	476
	Go
	510 803 609 088
	
	Taille totale des datafiles elasticsearch-log (tous nœuds confondus)
	82
	Go
	88 113 938 432
	Note : l&apos;hypothèse est déjà sur es-log

	
			
	
	

		Besoins en ressources par instance (hors OS)
		Besoin en resources de ce cluster de composants

	Zone VITAM
	Composant
	Rôle
	Hôtes
	Nb. instances
	Notes
	CPU
	RAM Process (Go)
	RAM OS (cache) (Go)
	Réservation RAM (Go)
	/vitam/data (Go)
	Données stockées dans data
	/vitam/logs (Go)
	/vitam/tmp (Go)
	Données stockées dans tmp
	Cluster : CPU
	Cluster : RAM
	Cluster : /vitam/data
	Cluster : /vitam/logs
	Cluster : /vitam/tmp

	Accès
	ingest-external
	API de versement externe
	external-api-*
	1
		1
	2
	1
	3
		10
	40
	Sas d&apos;entrée pour analyse antivirus
	1
	3
	0
	10
	40

	Accès
	access-external
	API de recherche externe
	external-api-*
	1
		1
	2
	0
	2
		10
	10
	Sas d&apos;entrée pour analyse AV des référentiels
	1
	2
	0
	10
	10

	Accès
	ihm-demo
	IHM
	external-api-*
	1
		1
	2
	0
	2
		10
		1
	2
	0
	10
	0

	Applicative
	security-internal
	Gestion des informations d&apos;authentification
	internal-api-*
	1
		1
	2
	0
	2
	10
	??? Si clés stockées en local / sinon rien
	10
		1
	2
	10
	10
	0

	Applicative
	ingest-internal
	API de versement interne
	internal-api-*
	1
		1
	2
	0
	2
			10
		1
	2
	0
	10
	0

	Applicative
	access-internal
	API de recherche interne
	internal-api-*
	1
		1
	2
	0
	2
	200
	Journaux d&apos;accès
	10
		1
	2
	200
	10
	0

	Applicative
	processing
	Moteur d&apos;exécution
	internal-api-*
	1
		3
	3
	0
	3
	10
	Etat des workflows
	10
	20
	Listing des id distribués au sein d&apos;un workflow
	3
	3
	10
	10
	20

	Applicative
	worker
	Worker de versement
	worker-*
	3
		4
	3
	1
	4
		50
	0,078
	Données temporaires de travail
	12
	12
	0
	150
	0

	Applicative
	workspace
	Espace de travail
	internal-api-*
	1
		3
	3
	4
	7
	11
	Données de travail des processus en cours
	10
		3
	7
	11
	10
	0

	Applicative
	functional-administration
	Moteur administration fonctionnel &amp; référentiels
	data-services-*
	1
		1
	2
	0
	2
		10
	10
	Upload des fichiers de référentiel (à valider pour un passage dans Workspace)
	1
	2
	0
	10
	10

	Applicative
	logbook
	Journalisation applicative
	data-services-*
	1
		2
	4
	0
	4
		10
		2
	4
	0
	10
	0

	Applicative
	metadata
	Moteur de données
	data-services-*
	1
		2
	4
	0
	4
		10
		2
	4
	0
	10
	0

	Applicative
	storage
	Moteur de stockage
	storage-*
	2
		4
	3
	0
	3
		10
		8
	6
	0
	20
	0

	Données
	elasticsearch-data
	Indexation des MD
	db-*
	3
		3
	6
	6
	12
	159
	Bases de métadonnées / référentiels / journaux / …
	10
		9
	36
	476
	30
	0

	Données
	mongos
	Sharding de la base de données MD
	db-*
	3
	Nombre d&apos;instances indépendant du nombre de shards
	2
	3
	0
	3
		10
		6
	9
	0
	30
	0

	Données
	mongoc
	Configuration de la base de données MD
	db-*
	3
	Nombre d&apos;instances indépendant du nombre de shards
	1
	2
	0
	2
	10
		10
		3
	6
	30
	30
	0

	Données
	mongod
	Base de données MD
	db-*
	3
	Le nombre de serveur mongod = nombre de shards * nombre de replica
	3
	6
	12
	104
	Bases de métadonnées / référentiels / journaux / …
	10
		9
	36
	312
	30
	0

	Exploitation &amp; administration
	ansible
	Moteur de déploiement et configuration
	ansible
	1
		0,5
	2
	0
	2
		s/o
	10
		s/o
	1
	2
	0
	10
	0

	Exploitation &amp; administration
	logstash
	Aggrégateur de logs techniques
	log-*
	1
		2
	2
	0
	2
		10
		2
	2
	0
	10
	0

	Exploitation &amp; administration
	kibana
	Dashboard de logs techniques
	log-*
	1
		0,5
	0,5
	0
	0,5
		10
		1
	1
	0
	10
	0

	Exploitation &amp; administration
	elasticsearch-log
	Indexation des logs techniques
	log-elastic-*
	3
		3
	4
	6
	10
	27
	Logs techniques
	10
		9
	30
	82
	30
	0

	Exploitation &amp; administration
	consul (server)
	Annuaire de services
	log-elastic-*
	3
		1
	1
	0
	1
	10
	Données de fonctionnement du cluster consul
	10
		3
	3
	30
	30
	0

	Stockage
	offer (config filesystem)
	Offre de stockage (filesystem ou ceph)
	storage-offer-*
	2
		3
	3
	Note : on écrit beaucoup, mais on ne lit que très peu ce qu&apos;on a écrit, non ? Donc on fait beaucoup de cache miss a priori, pas besoin d&apos;un cache monstrueux
2
	5
	9 777
	Données binaires des archives
	10
		6
	10
	19555
	20
	0

	Stockage
	offer (config ceph)
	Offre de stockage (filesystem ou ceph)
	storage-offer-*
	0
		3
	3
	0
	3
			10
		0
	0
	0
	0
	0


				Résultat par instance
	Résultat par cluster de VM

			Data
			
	Zone VITAM
	Hôtes
	Max - Nb. instances
	Sum - CPU
	Sum - Réservation RAM (Go)
	Sum - Cluster : CPU
	Sum - Cluster : RAM
	Sum - Cluster : /vitam/data
	Sum - Cluster : /vitam/logs
	Sum - Cluster : /vitam/tmp

	Accès
	external-api-*
	1
	3
	7
	3
	7
	0
	30
	50

	Applicative
	data-services-*
	1
	5
	10
	5
	10
	0
	30
	10

		internal-api-*
	1
	9
	16
	9
	16
	231
	50
	20

		storage-*
	2
	4
	3
	8
	6
	0
	20
	0

		worker-*
	3
	4
	4
	12
	0
	150
	0

	Données
	db-*
	3
	9
	29
	27
	87
	817
	120
	0

	Exploitation &amp; administration
	ansible
	1
	1
	2
	1
	2
	0
	10
	0

		log-*
	1
	3
	2,5
	3
	0
	20
	0

		log-elastic-*
	3
	4
	11
	12
	33
	112
	60
	0

	Stockage
	storage-offer-*
	2
	3
	5
	6
	10
	19555
	20
	0

	Total Result
		3
	44
	89,5
	85
	186
	20715
	510
	80

	
		Nombre totales d&apos;instances
	18
	
	
			Consommation CPU OS
	Consommation RAM OS
	
		Consommation OS
	Unitaire
		1
	2
	
		Globale
		18
	36
	
			
		Consommation totale infra
			103
	222
	

	Ko
	1024
		Octets2Go
	9,31322574615479E-10

	Mo
	1048576
	
	Go
	1073741824
	
	To
	1099511627776
	
	s/o
	1
	
	n/a
	1
	
	octets
	1
	
	%
	0,01
	
	 
	1
	

	
	Manquent, comme données ou hypothèses

	Prendre en compte la sécurisation des journaux dans le journal des écritures

	
	A revoir

	Le calcul des logs

	Le dimensionnement des serveurs (qui ne devrait pas être statique, mais idéalement dépendre des hypothèses)

	Le dimensionnement des bases (plutôt se servir de l&apos;exemple de nos ptfs)


</TextContent>
</Content>